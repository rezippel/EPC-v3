%$Id: cont-frac.tex,v 1.2 1992/05/10 19:34:57 rz Exp rz $
\chapter{Continued Fractions} 
\label{CF:Chap}

\def\Ddots{\mbox{\raisebox{-2ex}{$\ddots$}}}
\index{continued fraction|(}


By a \keyi{continued fraction} we mean an expression of the form
\[
a_0 + \frac{b_1}{\displaystyle a_1 + \frac{b_2}{\displaystyle a_2 + \Ddots}}\ .
\]
When this expression is finite, it represents a rational number. The
infinite form of of the continued fraction is defined to be the 
limiting value of the sequence 
\[
a_0, \quad a_0 + \frac{b_1}{a_1}, \quad 
a_0 + \frac{b_1}{\displaystyle a_1 + \frac{b_2}{a_2}}, \quad \ldots,
\]
if the limit exists.  Assume the limit does exist, and denote it by
$\alpha$.  The elements of this sequence are called the  
{\em continued fraction convergents}\index{convergents!of a continued
fraction} of $\alpha$.  When the $b_i$ are equal to 1, the 
elements of the above sequence are quite good approximations to
$\alpha$ and, in a certain sense, all of the ``best'' approximations
to $\alpha$ are elements of the sequence.

The major goal of this chapter is to make these concepts precise and
to provide algorithms for determining these convergents efficiently.
These results will provide efficient algorithms for solving certain
diophantine problems.

\section{Basics}
\label{CF:Basics:Sec}

We consider only continued fractions where the numerators are $1$,
\ie, fractions of the form
\[
a_0 + \frac{1}{\displaystyle a_1 + \frac{1}{a_2 + \Ddots}},
\]
and where the $a_i$ are positive integers.  A continued fraction of
this form is called a {\em simple continued
fraction\/}\index{continued fraction!simple}.  To simplify the
notation, simple continued fractions are written as
\[
a_0 + \frac{1}{\displaystyle a_1 + \frac{1}{a_2 + \Ddots}}
    = [a_0,a_1, a_2, \ldots].
\]
The $a_i$ are called the {\em partial quotients}\index{partial
quotient} of the continued fraction.  The $n$-th {\em
convergent}\index{continued fraction!convergent} of a continued
fraction is defined as:
\[
\frac{P_n}{Q_n} = [a_0, a_1, \ldots, a_n].
\]
\addsymbol{$[a_0, a_1, \ldots]$}{Continued fractions with partial
quotients $a_i$}

Let $\alpha = [a_0, a_1, \ldots]$, where only the finite
series is well defined at this time.  Notice that the expression
\[
\frac{1}{\displaystyle a_1 + \frac{1}{a_2  + \Ddots}}
\]
is always positive and less than $1$.  Therefore, $a_0$ is the
\key{integer part} of $\alpha$, which we denote by 
$\lfloor \alpha \rfloor$.  (We use $\lceil \alpha \rceil$ to denote
the smallest integer greater than or equal to $\alpha$.)  The second
partial quotient is
\[
a_1 = \left\lfloor \frac{1}{\alpha - a_0} \right \rfloor = \lfloor
\alpha_1 \rfloor,
\]
and so on. 
\addsymbol{$\lfloor \alpha \rfloor$}{The greatest integer less than or
equal to $\alpha$}
\addsymbol{$\lceil \alpha \rceil$}{The smallest greatest integer
greater than or equal to $\alpha$}


If $\alpha$ is a rational number, this process will terminate with a
finite simple continued fraction of the form
\[
\alpha = [a_0, a_1, \ldots, a_n ] = [a_0, a_1, \ldots, a_n -1, 1],
\]
where the last step is a reflection of the identity
\[
k = (k-1) + \frac{1}{1}.
\]
Any finite continued fraction represents a rational number, so 
irrational numbers have infinite continued fractions expansions.
These expansions are unique, the proof of which we leave to the
reader.  We summarize these results in the following proposition.

\begin{proposition}
Let the simple continued fraction expansion of $\alpha$ be
\[
\alpha = [a_0, a_1, \ldots, a_k, \ldots ].
\]
If $\alpha$ is irrational this expansion will not terminate and it is
unique.  If $\alpha$ is rational, then it has precisely two simple
continued fraction expansions and they are related as follows
\[
\alpha = [a_0, a_1, \ldots, a_n] = [a_0, a_1, \ldots, a_n-1, 1].
\]
Thus a rational number has a unique continued fraction expansion with
an even number of partial quotients and a unique continued fraction
expansion with an odd number of partial quotients.

\end{proposition}

\bigskip
A good example of the types of approximations produced by continued
fractions  is given by $\pi$.  Apply the procedure given above
to $\pi$ (using a calculator, for instance) gives
\[
\begin{array}{rlc}
\alpha = \pi &= 3.141592653589793\ldots & a_0 = 3 \\
\alpha_1 = (\pi - 3)^{-1} &= 7.062513305931052\ldots 
   & a_1 = 7 \\
\alpha_2 = (\alpha_1 - 7)^{-1} &= 15.996594406684104\ldots 
   & a_2 = 15 \\
\alpha_3 = (\alpha_2 - 15)^{-1} &= 1.0034172310150003\ldots 
   & a_3 = 1 \\
\vdots  & \vdots 
\end{array}
\]
When computed with enough precision, we discover that
\[
\pi = [3,7,15,1,292,1,1,1,2,1,3,1,14,2,1,1,2,2,2,2,1,84, \ldots].
\]
The resulting convergents are 
\[
3,\quad \frac{22}{7},\quad \frac{333}{106},\quad \frac{355}{113},
  \quad \frac{103993}{33102}.
\]
The first convergent is the Biblical value for $\pi$, the second is
the value often used in hand calculations prior to the appearance of
the calculator, and the fourth is well known as being an exceptionally
accurate value for a fraction with such a small denominator---its
error is less that $10^{-6}$.  In general, the convergent before a
particularly large partial quotient will be especially
accurate.\index{$\pi$, biblical value}

The numerical values of the continued fraction convergents of $\pi$ given
above are
\[
3.0,\quad 3.142857, \quad 3.141509, \quad 3.141593, \quad 3.1415926.
\]
Notice that these approximations are alternately larger and then smaller
than $\pi$.  This is true of all simple continued fractions, as we
shall prove in \propref{CF:Convergence:Prop}.

\bigskip

To simplify some of the notation that follows it is convenient to add two
extra convergents to the set derivable from the continued fraction.  The value
of a simple continued fraction is always less than $\infty$ and greater than
0.  We can preserve the alternating behavior of the convergents by letting
the $-1${\st} convergent be $1/0$ and the $-2$-nd be $0/1$.

The first few convergents of a continued fraction
$[a_0, a_1, a_2, \ldots]$ are thus
\[
\begin{array}{c|ccccc}
n & -2 & -1 & 0 & 1 & 2 \\ \hline\noalign{\vspace{2pt}}
\displaystyle\frac{P_n}{Q_n} & \displaystyle\frac{0}{1}& \displaystyle\frac{1}{0}&
\displaystyle\frac{a_0}{1}& \displaystyle\frac{a_0 a_1 + 1}{a_1} &
\displaystyle\frac{a_0 a_1 a_2 + a_2 + a_0}{a_1 a_2 + 1}
\end{array}
\]
These examples suggest that the convergents of a continued fraction
satisfy the following simple pair of recurrence relations:
\begin{equation}
\label{CFRecurrence:Eq}
 \begin{aligned}
  P_{n+1} &= a_{n+1} P_n + P_{n-1},\\
  Q_{n+1} &= a_{n+1} Q_n + Q_{n-1}.
 \end{aligned}
\end{equation}
This is in fact the case and will be shown in
\propref{CF:Recurrence:Prop}. First, we show that sequences that
satisfy \eqnref{CFRecurrence:Eq} satisfy certain identities.

\begin{proposition}\label{CF:Identities:Prop}
If $P_k/Q_k$ satisfy the relations \eqnref{CFRecurrence:Eq} then 
\begin{align}
  P_n Q_{n-1} - P_{n-1} Q_n &= (-1)^{n-1}, \label{CFUnitIdentity:Eq} \\
  P_n Q_{n-2} - P_{n-2} Q_n &= a_n(-1)^{n}. \label{CF:2Dif:Identity:Eq} 
\end{align}
\end{proposition}

\begin{proof}
The first identity is easily shown using induction.  Equation
\eqnref{CFUnitIdentity:Eq} is true for $n= 0, 1$.  Assuming
\eqnref{CFUnitIdentity:Eq} is true for $n = k$ we have for $n = k+1$: 
\[
\begin{aligned}
  P_{k+1} Q_k - P_k Q_{k+1}
    & =(a_{k+1} P_k + P_{k-1}) Q_k - P_k \,(a_{k+1} Q_k + Q_{k-1})\\
    &= P_{k-1} Q_k - P_k Q_{k-1} \\
    &= (-1)^{k}
\end{aligned}
\]

Rewriting \eqnref{CFUnitIdentity:Eq} in terms of the convergents gives
\[
\frac{P_n}{Q_n} - \frac{P_{n-1}}{Q_{n-1}} = \frac{(-1)^{n-1}}{Q_{n-1}
Q_n}.
\]
Consequently,
\[
\begin{aligned}
\frac{P_n}{Q_n} - \frac{P_{n-2}}{Q_{n-2}} &= 
 \frac{P_n}{Q_n} - \frac{P_{n-1}}{Q_{n-1}} + 
 \frac{P_{n-1}}{Q_{n-1}} - \frac{P_{n-2}}{Q_{n-2}}, \\
& = \frac{(-1)^{n-1}}{Q_{n-1}Q_n} + \frac{(-1)^{n}}{Q_{n-2}Q_{n-1}}
  = \frac{(-1)^{n}}{Q_{n-2} Q_n}\left[ \frac{Q_n - Q_{n-2}}{Q_{n-1}}
     \right], \\
 & = a_n \frac{(-1)^n}{Q_{n-2} Q_n}.
\end{aligned}\]
Clearing denominators gives \eqnref{CF:2Dif:Identity:Eq}.
\end{proof}

Notice that $P_n$ and $Q_n$ are relatively prime, since any common
divisor they shared would also divide $-1$.  Now we demonstrate that the
$P_k/Q_k$, as defined by \eqnref{CFRecurrence:Eq}, are the convergents
of the continued fraction of their limit.

\begin{proposition}\label{CF:Recurrence:Prop}
If $P_k/Q_k = [a_0, a_1, \ldots, a_k]$, then $P_n$ and $Q_n$ satisfy
\eqnref{CFRecurrence:Eq} when each of the terms are defined.
Furthermore, if the $a_i$ are all positive then $P_i > P_j$ and $Q_i >
Q_j$ if and only if $i > j$.
\end{proposition}

\begin{proof}
This identity is easily verified for small $n$.  The other cases are
handled by induction.  Assume the identity is true for $n=k$.  From
the definition of a continued fraction it is clear that
\[
[a_0, a_1, \ldots, a_{k+1}] =
[a_0, a_1, \ldots, a_k + \frac{1}{a_{k+1}}]
\]
Consequently,
\[
\begin{aligned}
  \frac{P_{k+2}}{Q_{k+2}} &=
      \frac{\left(\displaystyle a_{k+1} + \frac{1}{a_{k+2}}\right) P_{k} + P_{k-1}}{\left(\displaystyle a_{k+1} + \frac{1}{a_{k+2}}\right) Q_{k} + Q_{k-1}},\\
    & = \frac{a_{k+1} a_{k+2} P_k + P_k + a_{k+2} P_{k-1}}{
              a_{k+1} a_{k+2} Q_k + Q_k + a_{k+2} Q_{k-1} },\\
    & = \frac{a_{k+2} P_{k+1} + P_k}{a_{k+2} Q_{k+1} + Q_k}.
\end{aligned}
\]
Since, $P_{k+2}$ and $Q_{k+2}$ are relatively prime we can equate the
numerators and denominators of this equation to get the identities.

The final statement in the proposition follows immediately from
\eqnref{CFRecurrence:Eq}.  
\end{proof}

The recurrence relations \eqnref{CFRecurrence:Eq} make computing the
convergents of a continued fraction very easy, as shown in the
computation of the convergents of $\pi$ in the tableau below.
\[
\begin{array}{|c|c|c|c|c|c|c|}
\multicolumn{1}{c}{} & \multicolumn{1}{c}{} & 
\multicolumn{1}{c}{3} & \multicolumn{1}{c}{7} & 
\multicolumn{1}{c}{15} & \multicolumn{1}{c}{1} &
\multicolumn{1}{c}{292} \\ \hline
0 & 1 & 3 \times 1 +0 = 3 & 7 \times 3 +1 = 22 &
 333 & 355 & 103993\\ \hline
1 & 0 & 3 \times 0 +1 = 1 & 7 \times 1 + 0 = 7 &
 106 & 113 & 33102\\ \hline
\end{array}
\]

\medskip
The convergence properties of continued fractions are easily deduced
by rewriting the \eqnref{CFUnitIdentity:Eq} in the
form:\index{continued fraction!convergence}
\[
\frac{P_k}{Q_k} - \frac{P_{k-1}}{Q_{k-1}} =
\frac{(-1)^{k-1}}{Q_{k-1}Q_k}.
\]
Summing these equalities for $k = 1, \ldots, N$ gives
\[
\frac{P_N}{Q_N} - \frac{P_0}{Q_0} =
\frac{1}{Q_0 Q_1} - \frac{1}{Q_1 Q_2} + \cdots +
\frac{(-1)^{N-1}}{Q_{N-1} Q_N},
\]
which can be rewritten as
\begin{equation} \label{CF:Sum:Approx:Eq}
\frac{P_N}{Q_N} = a_0 + \sum_{1 \le k \le N} \frac{(-1)^{k+1}}{Q_k
Q_{k-1}}.
\end{equation}

From \eqnref{CFRecurrence:Eq}, the numerator and denominator of a
continued fraction increase at least as fast as the \key{Fibonacci
numbers}.  By the reasoning in \sectref{Integer:Euclidean:Sec}, we
have $Q_k \approx \phi^k$ and thus the summation
\eqnref{CF:Sum:Approx:Eq} converges at least as fast a geometric
series.  Thus simple continued fractions always represent convergent
sequences.

By \eqnref{CF:2Dif:Identity:Eq}, $P_{n}/Q_{n} - P_{n-2}/Q_{n-2}$ is
positive if $n$ is even and negative if $n$ is odd.  Thus even
convergents of the continued fraction tend upwards towards $\alpha$
monotonically while the odd convergents tend downwards monotonically
towards $\alpha$.  This is also reflected by the fact that the sign of
$P_n/Q_n - P_{n-1}/Q_{n-1}$ alternates, thus two adjacent
convergents of a continued fraction bracket $\alpha$.

These comments are summarized in the following proposition.

\begin{proposition}\label{CF:Convergence:Prop}
The sequence of convergents $P_n/Q_n$ of a simple continued fraction
expansion of the irrational number $\alpha$ converges to $\alpha$.
For any $k$, the $P_{2k}/Q_{2k}$ converge monotonically upwards
towards $\alpha$, while $P_{2k+1}/Q_{2k+1}$ converge monotonically
downwards towards $\alpha$.  Furthermore
\[
\frac{P_{2k}}{Q_{2k}} < \alpha < \frac{P_{2k+1}}{Q_{2k+1}}.
\]
\end{proposition}

If $\alpha$ is an irrational number then the continued fraction
expansion for $\alpha$ does not terminate.  Combining
\propref{CF:Convergence:Prop} with \propref{CF:Identities:Prop} we
have the following:

\begin{proposition}\label{CF:RatApprox:Prop}
If $\alpha$ is an irrational number, then there are an infinite number
of $p_i$ and $q_i$ such that
\[
\left|\alpha - \frac{p_i}{q_i}\right| \le \frac{1}{q_i^2}.
\]
\end{proposition}


\section{Matrix Representation}
\label{CF:Matrix:Sec}

\index{continued fraction!matrix representation|(}

There are two other ways to organize the algebraic formulas of
continued fractions.  In this section we present the matrix
representation and in \sectref{CF:Continuant:Sec} introduce the
``continuant'' representation.

Let $\alpha_0$ be a positive real number and $[a_0, a_1, a_2, \ldots]$
be its continued fraction expansion.  Consider the (positive real)
numbers $\alpha_1 = [a_1, a_2, \ldots]$ and $\alpha_2 = [a_2, a_3,
\ldots].$ They are related to $\alpha$ by the following formulas
\[
\alpha_0 = a_0 + \frac{1}{\alpha_1} =\frac{a_0 \alpha_1 + 1}{\alpha_1}
   = f_0 (\alpha_1),
\]
while
\[
\alpha_1 = \frac{a_1 \alpha_2 + 1}{\alpha_2} = f_1(\alpha_2).
\]
So,
\begin{equation}\label{CF:2Step:Eq}
\alpha_0 = (f_0 \circ f_1) (\alpha_2) 
  = \frac{(a_0 a_1 + 1) \alpha_2 + a_0}{a_1 \alpha_2 + 1},
\end{equation}
where
\[
f_0(t) = \frac{a_0 t +1}{t}, \qquad\mbox{and}\qquad
 f_1(t) = \frac{a_1 t +1}{t}.
\]

The functions $f_0$ and $f_1$, which are ratios of two linear
polynomials, are examples of \keyi{fractional linear functions}.
Their action can be represented by matrices, viz.,
\[
f (x) = \frac{a x + b}{c x + d} \longleftrightarrow 
\begin{pmatrix} a & b \\ c & d \end{pmatrix}.
\]
The composition of two fractional linear functions is represented by
the product of the matrices. So $f_0 \circ f_1$ is represented by 
\[
\begin{pmatrix}a_0& 1 \\ 1 &0\end{pmatrix} \times
\begin{pmatrix}a_1& 1 \\ 1 &0\end{pmatrix}
=
\begin{pmatrix}a_0 a_1 + 1& a_0 \\ a_1 & 1\end{pmatrix},
\]
which agrees with \eqnref{CF:2Step:Eq}.

We can associate with the continued fraction of $\alpha_0$ the
matrix product 
\[
\begin{pmatrix} a_0 & 1 \\ 1 & 0 \end{pmatrix} \begin{pmatrix}a_1&1\\1&0\end{pmatrix} 
  \begin{pmatrix}a_2&1\\1&0\end{pmatrix} \cdots.
\]
If $P_k$ and $Q_k$ are convergents of a continued fraction, then
\[
\begin{pmatrix}P_k&P_{k-1}\\ Q_k&Q_{k-1}\end{pmatrix} \begin{pmatrix}a_{k+1}&1\\1&0\end{pmatrix}
  = \begin{pmatrix}a_{k+1}P_k+P_{k-1}& P_k\\ a_{k+1}Q_k+Q_{k-1}& Q_k\end{pmatrix}
  = \begin{pmatrix}P_{k+1}&P_k\\ Q_{k+1}&Q_k\end{pmatrix},
\]
using \eqnref{CFRecurrence:Eq}.  Matrix multiplication gives a concise
representation of the computation of the partial quotients of a
continued fraction.  With only a slight abuse of notation, we write
\[
\alpha = 
  \begin{pmatrix}a_0&1\\1&0\end{pmatrix} \begin{pmatrix}a_1&1\\1&0\end{pmatrix} 
  \begin{pmatrix}a_2&1\\1&0\end{pmatrix} \cdots.
\]

If we truncate this equation after $k+1$ factors we have
\begin{equation} \label{CFMatrixIdentity:Eq}
  \begin{pmatrix}P_k&P_{k-1}\\ Q_k&Q_{k-1}\end{pmatrix} =
  \begin{pmatrix}a_0&1\\1&0\end{pmatrix} \cdots
  \begin{pmatrix}a_k&1\\1&0\end{pmatrix},
\end{equation}
where $P_k$ and $Q_k$ are the convergents of $\alpha$.
\[
\frac{P_k}{Q_k} = [a_0, a_1, \ldots, a_k].
\]

We can derive the identity \eqnref{CFUnitIdentity:Eq} from
\eqnref{CFMatrixIdentity:Eq} easily.  The determinant of the left
hand side of \eqnref{CFMatrixIdentity:Eq} is $P_k Q_{k-1}-P_{k-1}
Q_k$.  The determinant of the right hand side is the product of the
determinant of each of the matrices, which are each $-1$.  Since there
are $k+1$ matrices we have
\[
P_k Q_{k-1}-P_{k-1} Q_k = (-1)^{k+1}.
\]

Using the rational function interpretation of the matrix form, this
immediately yields the following proposition.

\begin{proposition}\label{CF:Bilinear:Subst:Prop}
If
\[
\alpha = [a_0, a_1, \ldots, a_k, \beta]
\]
then
\[
\alpha = \frac{P_k \beta + P_{k-1}}{Q_k \beta + Q_{k-1}}.
\]
\end{proposition}

The $2\times 2$ matrices that arise with this representation all have
integer entries and their determinant is equal to $\pm 1$.
Consequently these matrices have inverses that also have integer
entries.  A square matrix of any dimension with these properties is
called a \keyi{unimodular matrix}.

\index{continued fraction!matrix representation|)}

\section{Continuant Representation}
\label{CF:Continuant:Sec}

\index{continued fraction!continuant representation|(}

The continuant representation focuses on the numerator and denominator
of convergents of a continued fraction and allows us to focus on the
contribution of each partial quotient in the formulas.  Define $K() =
1$, $K(a_0) = a_0$ and
\[
K(a_0, a_1, \ldots, a_{k-1}, a_k) = a_k K(a_0, \ldots, a_{k-1}) +
K(a_0, \ldots, a_{k-2}).
\]
This corresponds precisely to the equations used in
\eqnref{CFRecurrence:Eq}.  In particular if $P_k$ and $Q_k$ are
convergents of $[a_0, \ldots, a_k]$ then
\addsymbol{$K(a_0, \ldots, a_k)$}{Continuant representation of a
continued fraction}
\[
\begin{aligned}
P_k & = K(a_0, \ldots, a_k), \\
Q_k & = K(a_1, \ldots, a_k).
\end{aligned}
\]
Thus 
\[
\begin{aligned}
\displaystyle
\frac{K(a_0, \ldots, a_k)}{K(a_1, \ldots, a_k)} 
  &\displaystyle = [a_0, \ldots, a_k] = a_0 + \frac{1}{[a_1, \ldots, a_k]}, \\
  & \displaystyle = a_0 + \frac{1}{\displaystyle \frac{K(a_1, \ldots, a_k)}{K(a_2,
                \ldots, a_k)}}, \\
  & \displaystyle = \frac{a_0 K(a_1, \ldots, a_k) + K(a_2, \ldots,
                a_k)}{K(a_1, \ldots, a_k)}.
\end{aligned}
\]
Clearing fractions gives the recurrence
\begin{equation}\label{ContinuantRev:Eq}
K(a_0, \ldots, a_k) = a_0 K(a_1, \ldots, a_k) + K(a_2, \ldots, a_k), 
\end{equation}
which allows us to remove partial quotients off of both the front and
rear of a continued fraction!

This recurrence allows us to show that the value of a continuant is
unchanged when the order of the partial quotients is reversed.

\begin{proposition} \label{CF:Symmetric:Prop}
\[
K(a_0, a_1, a_2, \ldots, a_k) = 
K(a_k, a_{k-1}, \ldots,  a_0)
\]
\end{proposition}

\begin{proof}
This is is easily shown via induction.  It is trivially true for $k =
0, 1$.
\[
\begin{aligned}
 K(a_0, \ldots, a_{k+1}) 
    & = a_{k+1} K(a_0, \ldots, a_k) + K(a_0, \ldots, a_{k-1}), \\
    & = a_{k+1} K(a_k, \ldots, a_0) + K(a_{k-1}, \ldots, a_0), \\
    & = K(a_{k+1}, \ldots, a_0).
\end{aligned}
\]
where we have used \eqnref{ContinuantRev:Eq} in the last step.
\end{proof}

Equation \eqnref{CFUnitIdentity:Eq} has an interesting form for
symmetric sets of partial quotients.  Let
\[
\frac{P_n}{Q_n} = [\overbrace{\vphantom{b}a _0, a_1, a_2, \ldots, a_2, a_1,
a_0}^{n+1\ {\rm terms}}].
\]
Then
\[
\begin{array}{rl@{\qquad}rl}
P_n & = K(a_0, \ldots, a_0) & Q_n & = K(a_1, \ldots, a_1, a_0) \\
P_{n-1} & = K(a_0, \ldots, a_1) & Q_{n-1} & = K(a_1, \ldots, a_2, a_1)
\end{array}
\]
Substituting these values into \eqnref{CFUnitIdentity:Eq} gives
\[
K(a_0, \ldots, a_0) K(a_1, \ldots, a_1) 
  - K(a_0, \ldots, a_1) K(a_1, \ldots, a_0) = (-1)^{n-1}.
\]
Applying \propref{CF:Symmetric:Prop} gives
\begin{equation} \label{CF:Continuant:Unit:Eq}
K(a_0, a_1, \ldots, a_1)^2 - K(a_0, \ldots, a_0) K(a_1, \ldots, a_1)
= (-1)^n.
\end{equation}
This equation is used later in our study of the continued fraction of
the square root of an integer.

\index{continued fraction!continuant representation|)}

\section{Continued Fractions of Quadratics}
\label{CF:Quadratics:Sec}

A periodic decimal expansion is the expansion of a rational number.
If the simple continued fraction expansion of a number is periodic
then the number is the zero of an irreducible quadratic equation with
rational integer coefficients.\index{continued fraction!periodic} We
call such a number a \keyi{quadratic irrational}.  These numbers play
an important role in the study of continued fractions and the solution
of certain diophantine problems.

To simplify the notation we write the periodic continued fraction
expansion
\[
\alpha = [a_0, a_1, \ldots, a_{k-1}, a_{k}, a_{k+1}, \ldots, a_m, a_k,
a_{k+1}, \ldots],
\]
as
\[
\alpha = [a_0, \ldots, a_{k-1}, \overline{a_k, a_{k+1}, \ldots, a_m}],
\]
with the overbar indicating the periodic part.

Two essential results are proven in this section: (1) every periodic
continued fraction represents an irrational quadratic and conversely,
(2) every irrational quadratic has a periodic continued fraction
expansion.

\paragraph{Euler's Theorem}

{\Euler} first showed that a periodic continued fraction represents a
quadratic irrational \cite{Euler:CF}.

\begin{proposition}[Euler] \label{Euler:Periodic:Quad:Prop}
If $\alpha$ has the periodic continued fraction expansion
\[
\alpha = [a_0, \ldots, a_{k-1}, \overline{a_k, a_{k+1}, \ldots, a_m}],
\]
then $\alpha$ is an irrational quadratic.
\end{proposition}

\begin{proof}
Consider the number $\beta = [\overline{a_k, a_{k+1}, \ldots, a_m}]$,
so 
\[
\alpha = [a_0, a_1, \ldots, a_{k-1}, \beta].
\]
Since there exist integers $p$, $q$, $r$ and $s$ such that
\[
\alpha = \frac{p\beta + r}{q\beta + s},
\]
either $\alpha$ and $\beta$ are both rational or both are irrational.

By the definition of $\beta$, $\beta = [a_k, \ldots, a_m, \beta]$, \ie
\[
\beta = 
  \left(\begin{array}{cc}a_k& 1\\ 1 & 0\end{array}\right) 
\left(\begin{array}{cc}a_{k+1}& 1\\ 1 & 0\end{array}\right) 
  \cdots
\left(\begin{array}{cc}a_m& 1\\ 1 & 0\end{array}\right) \beta.
\]
By the discussion of the previous section, if the integers $P$, $Q$,
$R$ and $S$ are defined by
\begin{equation}\label{CF:Periodic:1:Eq}
\left(\begin{array}{cc}P& R\\ Q & S\end{array}\right) = 
\left(\begin{array}{cc}a_k& 1\\ 1 & 0\end{array}\right) 
\left(\begin{array}{cc}a_{k+1}& 1\\ 1 & 0\end{array}\right) 
  \cdots
\left(\begin{array}{cc}a_m& 1\\ 1 & 0\end{array}\right),
\end{equation}
then 
\[
\beta = \frac{P\beta + R}{Q \beta + S},
\]
and $\beta$ a solution of 
\begin{equation}\label{CF:Periodic:2:Eq}
Q\beta^2 + (S - P) \beta - R = 0.
\end{equation}
To show that $\beta$ is irrational, we must show that $(S - P)^2 +
4QR$, the discriminant of \eqnref{CF:Periodic:2:Eq}, is not a square.
Taking the determinant of \eqnref{CF:Periodic:1:Eq} we have
\[
PS - QR = \pm 1,
\]
thus
\[
\begin {aligned}
  (S-P)^2 + 4QR & = (S+P)^2 + 4 (QR - PS) \\
   & = (S+P)^2 \pm 4.
\end{aligned}
\]
Since no two non-zero square integers differ by $4$, $\beta$ is irrational.
\end{proof}

\paragraph{Reduced Quadratic Irrationals}
\index{irrational quadratic!reduced|(}

If $\alpha$ is an irrational quadratic that satisfies
\begin{equation}\label{CF:Conjugate:Eq}
aX^2 + b X + c = 0,
\end{equation}
then the other zero of \eqnref{CF:Conjugate:Eq}, which we denote by
$\alpha'$, is called $\alpha$'s {\em conjugate}\index{conjugate!of a
quadratic}.  The discriminant of $\alpha$ is $N = b^2 - 4ac$.  An
irrational real quadratic $\alpha$ is said to be {\em reduced} if
$\alpha > 1$ and if $-1 < \alpha' < 0$.

\begin{proposition}
Assume that $\alpha$ is a reduced quadratic number and
\[
\alpha =  [a_0, a_1, \ldots, a_k, \ldots].
\]
If $\beta$ is chosen such that
\[
\alpha = [a_0, a_1, \ldots, a_k, \beta]
\]
then $\beta$ is also a reduced quadratic number and has $N$ as its
discriminant. 
\end{proposition}

\begin{proof}

Without loss of generality, we can assume that $k = 0$, since $k> 0$
follows by induction.  $a_0$ is the largest integer less than
$\alpha$.  Therefore, $0 < \alpha - a_0 < 1$ and $\beta = (\alpha -
a_0)^{-1} > 1$.  Taking conjugates, we see that
\[
\beta' = \frac{1}{\alpha' - a_0}
\quad
\mbox{or}
\quad
-\frac{1}{\beta'} = a_0 - \alpha'.
\]
Since $\alpha$ is reduced, $0 < - \alpha' < 1$ and $a_0$ is a positive
integer.  So, $-1/\beta' > 1$.  Thus, $\beta'$ is negative.
Multiplying by $\beta'$ reverse the equality so $-1 < \beta'$.
Therefore, $-1 < \beta' < 0$ as required.

Since $\alpha$ is irrational, $\beta$ is also and the minimal
polynomial for $\beta$ is quadratic.  To find the minimal polynomial
for $\beta$, we substitute $a_0 + Y^{-1}$ for $X$ in
\eqnref{CF:Conjugate:Eq} and clear denominators
\[
Y^2 \left[ a \left(a_0 + \frac{1}{Y}\right)^2 + b \left(a_0 +
\frac{1}{Y} \right) + c \right] =
(a a_0^2 + b a_0 + c) Y^2 + (2a a_0 + b)Y + a = 0.
\]
The discriminant of $\beta$ is thus
\[
(2a a_0 + b)^2 - 4 (a a_0^2 + b a_0 + c) \cdot a = b^2 - 4 a c,
\]
which is the discriminant of \eqnref{CF:Conjugate:Eq}.
\end{proof}

We claim that there are only a finite number of reduced irrational
quadratics of the form \eqnref{CF:IQ:Eq} with a given discriminant
($N$).  Without loss of generality we can write an irrational
quadratic and its conjugate in the form
\begin{equation}\label{CF:IQ:Eq}
\alpha = \frac{P+\sqrt{N}}{Q} \qquad \mbox{and}\qquad
\alpha' = \frac{P-\sqrt{N}}{Q},
\end{equation}
where $Q > 0$.   If $\alpha$ is reduced then
\[
\alpha = \frac{P+\sqrt{N}}{Q} > 1 \qquad \mbox{and}\qquad
0 > \alpha' = \frac{P-\sqrt{N}}{Q} > -1.
\]
These inequalities can be rewritten as
\[
\begin{aligned}
P + \sqrt{N} & > Q, \\
\sqrt{N} & > P, \\
P+Q & > \sqrt{N}.
\end{aligned}
\]
The first two can be combined to give an upper bound for $Q$,
$2\sqrt{N} > Q$.  Negating this inequality and adding to the last 
inequality gives $P > - \sqrt{N}$.  So, we have
\[
\sqrt{N} > P > -\sqrt{N}
\quad \mbox{and} \quad
2\sqrt{N} > Q > 0.
\]
This proves the following proposition

\begin{proposition}
For each $N$ there are only a finite number of reduced irrational
quadratics of the form 
\[
\frac{P + \sqrt{N}}{Q}.
\]
\end{proposition}

This proposition shows that a reduced quadratic irrational must have a
purely periodic continued fraction.\index{continued fraction!purely
periodic}

Let $\alpha_i = [a_i, a_{i+1}, \ldots]$ and assume $\alpha_0$ is a
reduced quadratic irrational.  All of the $\alpha_i$ are then reduced,
and all share the same discriminant.  Since there are only a finite
number of such reduced quadratic irrationals, for some $i$ and
$m$, $\alpha_i = \alpha_{i+m}$.  By the uniqueness of the
continued fraction expansion, 
\[
\alpha_i = \alpha_{i+m} = \alpha_{i+2m} = \cdots = \alpha_{i + k m} = \cdots.
\]
Since $a_j = \lfloor \alpha_j \rfloor$, $a_i = a_{i+km}$.  Using
\[
\alpha_{i} = a_{i} + \frac{1}{\alpha_{i+1}} =
\alpha_{i+km} = a_{i} + \frac{1}{\alpha_{i+1+km}},
\]
we see that $a_i+1 = a_{i+1+km}$ and the entire period between $a_i$
and $a_{i-1+m}$ is repeated.

To show that $\alpha$ is {\em purely} periodic we will demonstrate
that $a_{i-1} = a_{i-1+m}$.  Induction then completes the proof.  We
have
\[
\alpha_{i-1} = a_{i-1} + \frac{1}{\alpha_i} \qquad \mbox{and}\qquad
\alpha_{i-1+m} = a_{i-1+m} + \frac{1}{\alpha_{i+m}}.
\]
Taking conjugates and rearranging we have
\[
-\frac{1}{\alpha'_i} = a_{i-1} - \alpha'_{i-1} \qquad\mbox{and}\qquad
-\frac{1}{\alpha'_{i+m}} = a_{i-1+m} - \alpha'_{i-1+m} .
\]
Since all of the $\alpha_{\ell}$ are reduced, we have
\[
-\frac{1}{\alpha'_i} = -\frac{1}{\alpha'_{i+m}} > 1 \qquad\mbox{and}\qquad
0 < -\alpha'_{i-1}, -\alpha'_{i-1+m} < 1.
\]
Thus $a_{i-1} = a_{i-1+m}$ is the integer part of $-1/\alpha'_i$.
This gives the following proposition. 

\begin{proposition}\label{CF:Reduced:Periodic:Prop}  
If $\alpha$ is a reduced quadratic irrational then $\alpha$'s
continued fraction expansion is purely periodic.
\end{proposition}

\index{irrational quadratic!reduced|)}

\paragraph{Lagrange's Theorem}

Finally we come to {\Lagrange}'s theorem \cite{Lagrange68}, which is the
converse of \propref{Euler:Periodic:Quad:Prop}.

\begin{proposition}[Lagrange]
If $\alpha$ is an irrational quadratic then $\alpha$ has a periodic
quadratic expansion.
\end{proposition}
\begin{proof}
Let $\alpha = [a_0, a_1, \ldots]$ and define $\alpha_k = [a_k,
a_{k+1}, \ldots]$.  By \propref{CF:Bilinear:Subst:Prop}, we have
\begin{equation}\label{CF:Lagrange:1:Eq}
\alpha = \frac{P_k \alpha_{k+1} + P_{k-1}}{Q_{k} \alpha_{k+1} + Q_{k-1}}.
\end{equation}
We will show that for some $k$, $\alpha_k$ is reduced.  The
proposition then follows from \propref{CF:Reduced:Periodic:Prop}. 

Since $\alpha_k > 1$, to show that $\alpha_{k+1}$ is reduced we must show
that $-1 < \alpha'_k < 0$.  Solving \eqnref{CF:Lagrange:1:Eq} and
taking conjugates, we have
\[
\alpha'_{k+1} = - \frac{Q_{k-1} \alpha' - P_{k-1}}{Q_k \alpha' - P_k}
 = - \frac{Q_{k-1}}{Q_k} 
  \left(\frac{\displaystyle\alpha' -
    \frac{P_{k-1}}{Q_{k-1}}}{\displaystyle\alpha' -
           \frac{P_{k}}{Q_{k}}}\right).
\]
As $k$ increases, both $P_{k-1}/Q_{k-1}$ and $P_k/Q_k$ tend towards
$\alpha$ so the quantity in parentheses tends towards $1$.  Since
$Q_{k-1} < Q_k$, for some value of $k$, $\alpha'_{k+1}$ will lie between
$-1$ and $0$.
\end{proof}

\paragraph{Square Roots of Integers}

Let $\alpha$ and $\alpha'$ be the roots of a quadratic equation
\[
aX^2 + bX + c = a (X - \alpha) (X - \alpha') = 0,
\]
with real coefficients.  Then $\alpha$ and $\alpha'$ are called {\em
conjugates}\index{conjugate!of an algebraic number} of each other.
Recall that either both $\alpha$ and $\alpha'$ are real or neither is
real.  The following proposition, due to {\Galois} \cite{Galois:CF},
relates the continued fraction of $\alpha$ to that of $\alpha'$.


\begin{proposition}[Galois] \label{CF:Galois:Rev:Prop}
Assume $\alpha$ is a reduced quadratic irrational and thus has the
purely periodic continued fraction expansion
\[
\alpha = [\overline{a_0, a_1, \ldots, a_{k-1}}].
\]
Denote the conjugate of $\alpha$ by $\alpha'$.  Then
\[
-\frac{1}{\alpha'} = [\overline{a_{k-1}, a_{k-2}, \ldots, a_1, a_0}].
\]
\end{proposition}

\begin{proof}
Letting $\alpha_i = [\overline{a_i, a_{i+1}, \ldots, a_{k-1}, a_0,
\ldots, a_{i-1}}]$, we have
\[
\alpha_0 = a_0 + \frac{1}{\alpha_1}, \qquad
\alpha_1 = a_1 + \frac{1}{\alpha_2}, \qquad \ldots \qquad
\alpha_{k-1} = a_{k-1} + \frac{1}{\alpha_0}.
\]
Taking conjugates and rearranging slightly we have
\[
-\frac{1}{\alpha'_1} = a_0 - \alpha'_0, \qquad
-\frac{1}{\alpha'_2} = a_1 - \alpha'_2, \qquad \ldots \qquad
-\frac{1}{\alpha'_0} = a_{k-1} - \alpha'_{k-1}.
\]
To clarify, let $\beta_i = -1/\alpha'_i$.  Reversing the order of the
previous sequence of equations gives
\[
\beta_0 = a_{k-1} + \frac{1}{\beta_{k-1}}, \qquad
\beta_{k-1} = a_{k-2} + \frac{1}{\beta_{k-2}}, \qquad\ldots \qquad
\beta_1 = a_0 + \frac{1}{\beta_{0}},
\]
so $[\overline{a_{k-1}, \ldots, a_{0}}] = \beta_0 = -1/\alpha'$.
\end{proof}

This proposition allows us to prove an important structural result
about the continued fraction expansion of the square root of an
integer. Let the continued fraction expansion of $\sqrt{N}$ be
\[
\sqrt{N} = [a_0, a_1, \ldots ].
\]
$\sqrt{N}$ is not reduced since $-\sqrt{N}$ is less than $-1$, but
$a_0 + \sqrt{N}$ is reduced.  Therefore, 
\[
a_0 + \sqrt{N} = [\overline{2a_0, a_1, \ldots, a_k}].
\]
By \propref{CF:Galois:Rev:Prop}
\[
-\frac{1}{a_0 - \sqrt{N}} = [\overline{a_k, a_{k-1}, \ldots, 2a_0}].
\]
Taking reciprocals and adding $2a_0$ to both sides gives
\[
\begin{aligned}
a_0 + \sqrt{N} & = [2a_0, \overline{a_k, a_{k-1}, \ldots, a_1, 2a_0}],\\
& = [\overline{2a_0, a_k, a_{k-1}, \ldots, a_1}].
\end{aligned}
\]
Comparing the partial quotients of these two expansions of
$a_0+\sqrt{N}$ gives the following proposition.

\begin{proposition} \label{CF:Sqrt:Form:Prop}
The simple continued fraction expansion of $\sqrt{N}$ where $N$ is an
integer, has the form
\[
\sqrt{N} = [a_0, \overline{a_1, a_2, \ldots, a_2, a_1, 2 a_0}].
\]
\end{proposition}

\begin{figure}
\begin{center}\footnotesize \tabcolsep=3.5pt
\begin{tabular}{||r|*{9}{c}||r|*{9}{c}||}\hline
    2&1&&&&&&&& & 53&7&3&1&&&&&& \\ \hline
    3&1&(1)&&&&&&& & 54&7&2&1&(6)&&&&& \\ \hline
    5&2&&&&&&&& & 55&7&2&(2)&&&&&& \\ \hline
    6&2&(2)&&&&&&& & 56&7&(2)&&&&&&& \\ \hline
    7&2&1&(1)&&&&&& & 57&7&1&1&(4)&&&&& \\ \hline
    8&2&(1)&&&&&&& & 58&7&1&1&1&&&&& \\ \hline
    10&3&&&&&&&& & 59&7&1&2&(7)&&&&& \\ \hline
    11&3&(3)&&&&&&& & 60&7&1&(2)&&&&&& \\ \hline
    12&3&(2)&&&&&&& & 61&7&1&4&3&1&2&&& \\ \hline
    13&3&1&1&&&&&& & 62&7&1&(6)&&&&&& \\ \hline
    14&3&1&(2)&&&&&& & 63&7&(1)&&&&&&& \\ \hline
    15&3&(1)&&&&&&& & 65&8&&&&&&&& \\ \hline
    17&4&&&&&&&& & 66&8&(8)&&&&&&& \\ \hline
    18&4&(4)&&&&&&& & 67&8&5&2&1&1&(7)&&& \\ \hline
    19&4&2&1&(3)&&&&& & 68&8&(4)&&&&&&& \\ \hline
    20&4&(2)&&&&&&& & 69&8&3&3&1&(4)&&&& \\ \hline
    21&4&1&1&(2)&&&&& & 70&8&2&1&(2)&&&&& \\ \hline
    22&4&1&2&(4)&&&&& & 71&8&2&2&1&(7)&&&& \\ \hline
    23&4&1&(3)&&&&&& & 72&8&(2)&&&&&&& \\ \hline
    24&4&(1)&&&&&&& & 73&8&1&1&5&&&&& \\ \hline
    26&5&&&&&&&& & 74&8&1&1&&&&&& \\ \hline
    27&5&(5)&&&&&&& & 75&8&1&(1)&&&&&& \\ \hline
    28&5&3&(2)&&&&&& & 76&8&1&2&1&1&5&(4)&& \\ \hline
    29&5&2&1&&&&&& & 77&8&1&3&(2)&&&&& \\ \hline
    30&5&(2)&&&&&&& & 78&8&1&(4)&&&&&& \\ \hline
    31&5&1&1&3&(5)&&&& & 79&8&1&(7)&&&&&& \\ \hline
    32&5&1&(1)&&&&&& & 80&8&(1)&&&&&&& \\ \hline
    33&5&1&(2)&&&&&& & 82&9&&&&&&&& \\ \hline
    34&5&1&(4)&&&&&& & 83&9&(9)&&&&&&& \\ \hline
    35&5&(1)&&&&&&& & 84&9&(6)&&&&&&& \\ \hline
    37&6&&&&&&&& & 85&9&4&1&&&&&& \\ \hline
    38&6&(6)&&&&&&& & 86&9&3&1&1&1&(8)&&& \\ \hline
    39&6&(4)&&&&&&& & 87&9&(3)&&&&&&& \\ \hline
    40&6&(3)&&&&&&& & 88&9&2&1&(1)&&&&& \\ \hline
    41&6&2&&&&&&& & 89&9&2&3&&&&&& \\ \hline
    42&6&(2)&&&&&&& & 90&9&(2)&&&&&&& \\ \hline
    43&6&1&1&3&1&(5)&&& & 91&9&1&1&5&(1)&&&& \\ \hline
    44&6&1&1&1&(2)&&&& & 92&9&1&1&2&(4)&&&& \\ \hline
    45&6&1&2&(2)&&&&& & 93&9&1&1&1&4&(6)&&& \\ \hline
    46&6&1&3&1&1&2&(6)&& & 94&9&1&2&3&1&1&5&1&(8) \\ \hline
    47&6&1&(5)&&&&&& & 95&9&1&(2)&&&&&& \\ \hline
    48&6&(1)&&&&&&& & 96&9&1&(3)&&&&&& \\ \hline
    50&7&&&&&&&& & 97&9&1&5&1&1&1&&& \\ \hline
    51&7&(7)&&&&&&& & 98&9&1&(8)&&&&&& \\ \hline
    52&7&4&1&(2)&&&&& & 99&9&(1)&&&&&&& \\ \hline
\end{tabular}
\end{center}
\caption{Simple Continued Fraction Expansions for
  $\protect\sqrt{N}$\label{CF:Sqrt:Table:Fig}} 
\end{figure}

Later we present an algorithm for computing the continued fraction
expansion of a quadratic irrational.  In \figref{CF:Sqrt:Table:Fig} we
give a short table of the continued fraction expansions of $\sqrt{N}$.
This table is abbreviated by only including one half of the period and
enclosing the central partial quotient of the period in parentheses.
For instance,
\[
\begin{aligned}
  \sqrt{22} & = [4, \overline{1, 2, 4, 2, 1, 8}], \\
  \sqrt{26} & = [5, \overline{10}], \\
  \sqrt{29} & = [5, \overline{2, 1, 1, 2, 10}].
\end{aligned}
\]

The table in \figref{CF:Sqrt:Table:Fig} has a large number of
intriguing patterns, such as
\[
\begin{aligned}
\sqrt{7}  & = [2,\overline{1, 1, 1, 4}], \\
\sqrt{14} & = [3,\overline{1, 2, 1, 6}], \\
\sqrt{23} & = [4,\overline{1, 3, 1, 8}], \\
\sqrt{34} & = [5,\overline{1, 4, 1, 10}], \\
\sqrt{47} & = [6,\overline{1, 5, 1, 12}].
\end{aligned}
\]
To discover the pattern of the discriminants on the left, we define
\[
n + \sqrt{D} = [\overline{2n, 1, n-1, 1}] = [2n, 1, n-1, 1, n+ \sqrt{D}].
\]
Clearing fractions and simplifying we get
\[
0 = \frac{n^3 + 3n^2 + (1-D) - D -1}{n^2+\sqrt{D}(n+1)+2n}
=\frac{(n+1)(n^2+2n - 1 -D)}{n^2+\sqrt{D}(n+1)+2n},
\]
which gives
\[
\sqrt{n^2+2n-1} = \sqrt{(n+1)^2-2} = [n, \overline{1, n-1, 1, 2n}].
\]

A huge variety of these types of patterns exist.  In 1765, {\Euler}
published tables of such formulas for continued fractions with periods
of length up $8$ \cite{Euler:Pell}.  There is a reasonably complete
theory of the structure that arises, but the most accessible
presentation is {\Perron}'s \cite{Perron:CF}, which is in German.  The following
presentation follows {\MuirT} \cite{Muir:Surds:74}, who appears to
have been the first to state the general result given in
\propref{CF:Muir:Prop}.

\propref{CF:Sqrt:Form:Prop} shows that the continued fractions of
square roots of integers all have the symmetric form:
\begin{equation} \label{CF:Symmetric:Eq}
[a_0, \overline{a_1, a_2, \ldots, a_2, a_1, 2a_0}].
\end{equation}
The square of all such symmetric continued fractions is not
necessarily an integer, but may be a rational number.  This is shown
in the following proposition.

\begin{proposition}\label{CF:Sqrt:Sym:Prop}
If $\alpha = [a_0, \overline{a_1, a_2, \ldots, a_2, a_1, 2a_0}]$
then 
\[
\alpha = \sqrt{\frac{K(a_0, a_1, \ldots, a_1, a_0)}{K(a_1, a_2,
\ldots,a_2, a_1)}},
\]
where $K()$ is the continuant notation of \sectref{CF:Continuant:Sec}.
\end{proposition}

\begin{proof}
Using the continuant representation of a continued fraction, we have 
\[
\begin{aligned}
  \alpha & = [a_0, a_1, \ldots, a_1, a_0 + \alpha] \\
    & = \frac{K(a_0, a_1, \ldots, a_1, a_0 + \alpha)}{K(a_1, \ldots,
a_1, a_0 + \alpha)}, \\
  & = \frac{(a_0 + \alpha) K(a_0, a_1, \ldots, a_1)+K(a_0, a_1,
\ldots, a_2)}{(a_0+\alpha) K(a_1, \ldots,a_1) + K(a_1, \ldots, a_2)}, \\
  & = \frac{K(a_0, a_1, \ldots, a_1, a_0) + \alpha K(a_0, a_1, \ldots,
a_1)}{K(a_1, \ldots, a_1, a_0) + \alpha K(a_1, \ldots, a_1)}.
\end{aligned}
\]

Using $K(a_0, a_1, \ldots, a_1) = K(a_1, \ldots, a_1, a_0)$ (from
\propref{CF:Symmetric:Prop}) and clearing fractions gives
\[
0 =  K(a_1, \ldots, a_1) \alpha^2 - K(a_0, a_1, \ldots, a_1, a_0),
\]
which proves the proposition.
\end{proof}

This result immediately gives the structure of continued fractions
with periods of length $1$:
\[
[n, \overline{2n}] = \sqrt{\frac{K(n,n)}{K()}} = \sqrt{n^2+1}.
\]
If the length period of the continued fraction is $2$ then 
\[
[n, \overline{a, 2n}] = \sqrt{\frac{K(n,a,n)}{K(a)}} =
\sqrt{\frac{an^2+2n}{a}}
= \sqrt{n^2+\frac{2n}{a}}.
\]
So, such a continued fraction exists only when $a$ divides $2n$.

This approach can be continued for continued fractions with longer
periods, but a more general technique was obtained by {\MuirT}
\cite{Muir:Surds:74}.  It is summarized in the following proposition.

\begin{proposition}[Muir] \label{CF:Muir:Prop}
Let $\alpha$ have the continued fraction expansion
\[
\alpha = [a_0, \overline{a_1, a_2, \ldots, a_2, a_1, 2a_0}],
\]
where the length of the period is $k$.  Denote by $P_i/Q_i$ the $i$-th
convergent of $\alpha$.  If $\alpha$ is the square root of an integer
then
\[
a_0 = \frac{m K(a_1, \ldots, a_1) 
            - (-1)^k K(a_1, \ldots, a_2) K(a_2,\ldots, a_2)}{2}
\]
and
\[
\alpha = \sqrt{a_0^2 + m K(a_1, \ldots, a_2) - (-1)^k K(a_2, \ldots, a_2)^2}.
\]
\end{proposition}

\begin{proof}
By \propref{CF:Sqrt:Sym:Prop}, 
\[
\alpha = \sqrt{\frac{K(a_0, \ldots, a_0)}{K(a_1, \ldots, a_1)}}
\]
and we want to determine when the fraction inside the radical is
integral. Expanding $K(a_0, \ldots, a_0)$ gives 
\[
\begin{aligned}
 K(a_0, \ldots, a_0) 
   & = a_0 K(a_1, \ldots, a_1, a_0) + K(a_2, \ldots,a_0), \\
   & = a_0^2 K(a_1, \ldots, a_1) + 2a_0 K(a_1, \ldots, a_2)
           + K(a_2, \ldots, a_2).
\end{aligned}
\]
So,
\begin{equation}\label{CF:Muir:Rad:Eq}
N = \frac{K(a_0, \ldots, a_0)}{K(a_1, \ldots, a_1)} =
 a_0^2 + \frac{2a_0 K(a_1, \ldots, a_2) + K(a_2, \ldots, a_2)}{K(a_1,
\ldots, a_1)}.
\end{equation}
$N$ is an integer when the second term on the right hand side is an
integer.  Since $K(a_1, \ldots, a_2)$ is integral and relatively prime
to $K(a_1, \ldots, a_2)$ the second term remains integral if and only if
\[
\frac{2 a_0 K(a_1, \ldots, a_2)^2 + K(a_1, \ldots, a_2) K(a_2, \ldots,
a_2)}{K(a_1, \ldots, a_1)}
\]
is an integer. Applying \eqnref{CF:Continuant:Unit:Eq} turns this into
\[
\frac{2a_0\left[K(a_1, \ldots, a_1) K(a_2, \ldots, a_2) +
(-1)^k\right]
  + K(a_1, \ldots, a_2) K(a_2, \ldots, a_2)}{K(a_1, \ldots, a_1)},
\]
which is an integer when 
\[
\frac{2 a_0 (-1)^k + K(a_1, \ldots, a_2) K(a_2, \ldots, a_2)}{K(a_1,
\ldots, a_1)} = (-1)^k m,
\]
for some integer $m$.  This means that $a_0$ must be of the form
\[
a_0 = \frac{m K(a_1, \ldots, a_1) - (-1)^k K(a_1, \ldots, a_2) K(a_2,
\ldots, a_2)}{2}.
\]
Substituting this expression for $a_0$ into the second term of
\eqnref{CF:Muir:Rad:Eq} gives 
\[
N = a_0^2 + mK(a_1, \ldots, a_2) 
- (-1)^k 
\frac{\left(K(a_1, \ldots, a_2)^2 - (-1)^k\right) K(a_2, \ldots, a_2)}{K(a_1,
\ldots, a_1)}.
\]
Applying \eqnref{CF:Continuant:Unit:Eq} to the numerator of the last
expression gives,
\[
\begin{aligned}
N & = a_0^2 + mK(a_1, \ldots, a_2) 
- (-1)^k 
\frac{K(a_1, \ldots, a_1) K(a_2, \ldots, a_2) K(a_2, \ldots, a_2)}{K(a_1,1
\ldots, a_1)}, \\
 & = a_0^2 + m K(a_1, \ldots, a_2) - (-1)^k K(a_2, \ldots, a_2)^2,
\end{aligned}
\]
which was to be shown.
\end{proof}

\paragraph{An Example}

Using {\MuirT}'s proposition, we can read off the conditions that
indicate when a continued fraction with a period of length $3$
represents the square root of an integer.  Assume that
\[
\sqrt{D} = [n, \overline{a, a, 2n}],
\]
which is required by \propref{CF:Sqrt:Form:Prop}.
By \propref{CF:Muir:Prop}, every such continued fraction $n$ has
the form
\[
n = \frac{m K(a,a) - (-1)^3 K(a) K()}{2}
  = \frac{m(a^2+1) + a}{2}.
\]
For $n$ to be an integer, both $m$ and $a$ must be even, which we
denote by $2m'$ and $2a'$ respectively.  This gives
$n = m' (4{a'}^2 +1) + a'$.  $D$ is then
\[
\begin{aligned}
  D &= n^2 + m K(a) -(-1)^3 K()^2, \\
    & = (m' (4{a'}^2 +1) + a')^2 + 4 m'a' + 1, \\
    & = 4 a'm'(2a'm'+1)(2{a'}^2 +1) + (a'+m')^2 + 1.
\end{aligned}
\]
Dropping the primes, this gives
\[
\begin{array}{l}
\sqrt{4 am(2am+1)(2a^2 +1) + (a+m)^2 + 1}  \\[6pt]
\qquad\qquad\qquad\qquad =
   [m (4a^2 +1) + a, \overline{2a, 2a, 2m (4a^2 +1) + a}],
\end{array}
\]
for all positive integer $a$ and $m$.

\paragraph{Algorithm for Square Roots of Integers}

The basic technique used to compute the continued fraction of a number
$\alpha_k$ is to set $a_k$ to the integer part of $\alpha_k$, set
\[
\alpha_{k+1} = \frac{1}{\alpha_k - a_k},
\]
and repeat the process with $\alpha_k$.  This naive approach can be
quite ineffective when one only knows the numerical value of
$\alpha_k$.  However an adaptation of this method,  when applied
to a quadratic number
\begin{equation} \label{CF:Quad:Irr:Eq}
\alpha_k = \frac{r_k + \sqrt{N}}{s_k}
\end{equation}
can be surprisingly efficient.  This method is described in detail below.

First, notice that any quadratic irrational can be placed in the form
\eqnref{CF:Quad:Irr:Eq}, where $N$ is not a perfect square and where
$r_k$, $s_k$ and $N$ are rational integers, and where $\sqrt{N}$
refers to the positive square root.  Let $m$ denote the integer part of
$\sqrt{N}$ and $\epsilon = \sqrt{N} - m > 0$.  Surprisingly, we do not
need any additional information to compute the integer part of
$\alpha_k$.
\[
\begin{aligned}
\displaystyle
 \left\lfloor \frac{r_k+\sqrt{N}}{s_k} \right\rfloor
 & \displaystyle
    = \left\lfloor \frac{r_k+m}{s_k} + \frac{\epsilon}{s_k} \right\rfloor, \\
  & \displaystyle
    \le \left\lfloor a_k + \frac{s_k - 1}{s_k} 
         + \frac{\epsilon}{s_k}\right\rfloor = a_k.
\end{aligned}
\]
So, we do not need to know $\epsilon$ to compute $a_k$.  Knowing $r_k$,
$s_k$ and $m$ suffices; $a_k$ is the integer part of $(r_k + m)/s_k$.

The computation of $r_{k+1}$ and $s_{k+1}$ is also easy.  Since
\[
\alpha_k = a_k + \frac{1}{\alpha_{k+1}}
\]
we have
\[
\begin{aligned}
\frac{r_k + \sqrt{N}}{s_k} 
  & = a_k + \frac{s_{k+1}}{r_{k+1}+\sqrt{N}}, \\
  & = a_k + \frac{s_{k+1}}{N - r_{k+1}^2} \left( \sqrt{N} -
r_{k+1}\right).
\end{aligned}
\]
Equating the coefficients of $\sqrt{N}$ gives
\[
\frac{1}{s_k} = \frac{s_{k+1}}{N - r_{k+1}^2}.
\]
Equating the coefficients of $(\sqrt{N})^0$ gives
\[
\begin{aligned}
  \frac{r_{k}}{s_{k}} & = a_k - \frac{s_{k+1}}{N - r_{k+1}^2} r_{k+1}, \\
      & = a_k - \frac{r_{k+1}}{s_k},
\end{aligned}
\]
where we have used the previous equality.  Thus given $m$, $N$, $r_k$
and $s_k$, we can produce $a_k$, $r_{k+1}$ and $s_{k+1}$ using the
following three assignments:
\[
\begin{aligned}
 a_k &= \displaystyle \left\lfloor \frac{r_k + m}{s_k} \right\rfloor, \\
 r_{k+1} & = s_k a_k - r_k, \\
 s_{k+1} & = \frac{N - r_{k+1}^2}{s_k}.
\end{aligned}
\]

This procedure is implemented  in the following
pseudo-procedure.\index{CFsqrt@\protect\texttt{CFsqrt}}
\begindsacode
CFsqrt(N) := $\{$\\
 \> $r_k \leftarrow  0$; $s_k \leftarrow 1$; $\mbox{m} \leftarrow \mbox{isqrt}(\mbox{N})$; \\
 \> loo\=p $\{$ \\
 \> \> $a_k \leftarrow  \lfloor (r_k+ \mbox{m})/s_k\rfloor$; \\
 \> \> print($a_k$); \\
 \> \> $r_{k+1} \leftarrow a_k s_k - r_k$; \\
 \> \> $s_{k+1} \leftarrow (N - r_{k+1}^2)/s_k$; \\
 \> \> $r_k \leftarrow r_{k+1}$; \\
 \> \> $s_k \leftarrow s_{k+1}$; \\
 \> \> $\}$ \\
 \> $\}$
\enddsacode

We present many algorithms in this form of pseudo-code.  The
representation should be self evident, but a few comments may be
helpful.  The subscripts on the variables $r_k$, $s_k$, etc are for
clarity and do not indicate that they are arrays of variables.  We
will always use the notation {\tt r[k]} to indicate arrays.  The
function \keyw{isqrt} computes the integer part of the square root of
its argument.  Additional constructs are discussed as they are
introduced.


\section{Approximation Properties}
\label{CF:Approximation:Sec}

By \propref{CF:Identities:Prop} we know that the convergents,
$P_k/Q_k$ of the continued fraction of $\alpha$ are ``good''
approximations of $\alpha$, \ie
\[
\left|\alpha - \frac{P_k}{Q_k} \right| < \frac{1}{Q_k^2}.
\]
In this section we consider the converse question.  Are {\em all}
``good'' approximations of $\alpha$ convergents of the continued
fraction of $\alpha$?  This is, in fact, true.  It is an extremely
valuable tool for many applications of good approximations.  It means
that only the convergents of continued fraction expansions need be
examined.  

We begin with two simple propositions.

\begin{proposition}\label{CF:Consecutive:Prop}
If $PS - QR = \pm 1$, $P$ and $Q$ are relatively prime and $Q > S > 0$
then  $R/S$ is the next to last convergent of the continued fraction
of $P/Q$.
\end{proposition}

\begin{proof}
Let $P/Q = [a_0, \ldots, a_n]$ where $n$ is chosen such that 
\[
PS - QR = (-1)^{n-1}.
\]
Then $P/Q = p_n/q_n$ where $p_i/q_i$ are the convergents of the
continued fraction of $P/Q$.  By \eqnref{CFUnitIdentity:Eq} of
\propref{CF:Identities:Prop} we have
\[
p_n S - q_n R = p_n q_{n-1} - p_{n-1} q_n.
\]
Rearranging gives
\[
p_n (S- q_{n-1} ) = q_n (R - p_{n-1}).
\]
Since $p_n$ and $q_n$ are relatively prime, $q_n$ must divide $S -
q_{n-1}$.  But since both $S$ and $q_{n-1}$ are less than $q_n = Q$,
$S$ must equal $q_{n-1}$, and so $p_{n-1} = R$.
\end{proof}

\begin{proposition}\label{CF:Consecutive:2:Prop}
Let $P$, $Q$, $R$ and $S$ be integers such that $PS-QR = \pm 1$ and $Q
> S > 0$.  If
\[
\alpha = \frac{P \zeta + R}{Q \zeta + S},
\]
where $\zeta > 1$ then $R/S$ and $P/Q$ are consecutive convergents of
the regular continued fraction of $\alpha$.
\end{proposition}

\begin{proof}
By \propref{CF:Consecutive:Prop} we have
\[
\alpha = \frac{p_n \zeta + p_{n-1}}{q_n \zeta + q_{n-1}}.
\]
\ie
\[
\alpha = \begin{pmatrix}a_0 & 1 \\ 1& 0\end{pmatrix} \cdots 
  \begin{pmatrix}a_n & 1 \\ 1 & 0 \end{pmatrix} \zeta.
\]
Let $\zeta$'s continued fraction expansion be $[a_{n+1}, a_{n+2},
\ldots ]$, so 
\[
\alpha = [a_0, a_1, \ldots, ].
\]
\end{proof}

The following proposition is the main result of this section.  It
provides a sufficient condition for a rational number to be a
convergent of a continued fraction. 

\begin{proposition}\label{RationalCF:Prop}
If $p/q$ is a rational approximation to $\alpha$ that satisfies 
\[
\left| \frac{p}{q} - \alpha \right| < \frac{1}{2 q^2}
\]
then $p/q$ is a convergent of the continued fraction of $\alpha$.
\end{proposition}

\begin{proof}
There exists an $\epsilon = \pm 1$ and a $\theta$, $0 < \theta <
\frac{1}{2}$ such that
\begin{equation}\label{RationCF:Prop:Eq}
\frac{p}{q} - \alpha = \epsilon \frac{\theta}{q^2}.
\end{equation}
Letting $p/q = [a_0, \ldots, a_n]$ we can choose $n$ such that
$\epsilon = (-1)^{n-1}$ and $p/q = p_n/q_n$.  Define  $\zeta$ by 
\[
\alpha = \frac{\zeta p_n + p_{n-1}}{\zeta q_n + q_{n-1}}.
\]
Using this expression in \eqnref{RationCF:Prop:Eq} we have
\[
\begin{aligned}
(-1)^{n-1} \frac{\theta}{q_n^2} & = \frac{p_n}{q_n} - \alpha =
   \frac{p_n}{q_n} 
     - \frac{\zeta p_n + p_{n-1}}{\zeta q_n + q_{n-1}},\\
  & = \frac{p_n q_{n-1} - p_{n-1} q_n}{q_n (\zeta q_n + q_{n-1})}.
\end{aligned}
\]
Using \eqnref{CFUnitIdentity:Eq},
\[
\frac{\theta}{q_n} = \frac{1}{\zeta q_n + q_{n-1}}.
\]
Solving for $\zeta$ we have
\[
\zeta = \frac{1}{\theta} - \frac{q_{n-1}}{q_n} > 1,
\]
since $q_n > q_{n-1}$.  By \propref{CF:Consecutive:2:Prop}, $p_n/q_n = p/q$
is a convergent of $\alpha$.
\end{proof}

\propref{RationalCF:Prop} shows that if $p/q$ is a sufficiently good
approximation of an irrational number then it must be the convergent
of a continued fraction.  Since every irrational number has an infinite
continued fraction, every irrational number has an infinite sequence
of approximations $p/q$ that are at least as good as $(2q^2)^{-1}$.
The following proposition of {\Hurwitz} \cite{Hurwitz91} makes this
precise. 

\begin{proposition}[Hurwitz]
Let $\alpha$ be an irrational real number, $0 \le \alpha \le 1$, 
then there exist an infinite number of fractions $p/q$ such that
\[
\left| \alpha - \frac{p}{q} \right| < \frac{1}{\sqrt{5} \,q^2}.
\]
\end{proposition}

Here we prove an even stronger theorem that is due to {\Nathanson}
\cite{Nathanson74}.  Notice that of all the irrational numbers,  the
most difficult to approximate are those that are equivalent to the
golden ratio.  Furthermore, the partial quotients of the golden ratio
are all equal to $1$.  This matches our intuition that large partial
quotients indicate especially good approximations.

Define $F(k) \subset [0, 1]$ to be the irrational numbers whose
continued fractions have no partial quotients greater than $k$,
\[
F(1) \varsubsetneq F(2) \varsubsetneq F(3  \varsubsetneq  \cdots.
\]
Thus $F(1)$ consists of the single element $(-1 + \sqrt{5})/2$, while
$F(2)$ is an infinite set.  Nathanson proved the following
proposition.

\begin{proposition}[Nathanson] \label{Nathanson:Prop}
Let $\alpha$ be an irrational number not equivalent to an element of
$F(k-1)$.  Then there exist infinitely many rational numbers $p/q$ such
that
\[
\left|\alpha - \frac{p}{q}\right| < \frac{1}{\sqrt{k^2 + 4} \, q^2}.
\]
\end{proposition}

\begin{proof}
Let $\alpha$ be an irrational number not equivalent to an element of
$F(k-1)$ and let $a_i$ be its partial quotients, $P_i/Q_i$ its
convergents.  By \eqnref{CFUnitIdentity:Eq}
\[
\left|\alpha - \frac{P_n}{Q_n}\right| + 
\left|\alpha - \frac{P_{n+1}}{Q_{n+1}}\right| =
\left| \frac{P_n}{Q_n} - \frac{P_{n+1}}{Q_{n+1}}\right|
=
\frac{1}{Q_n Q_{n+1}}.
\]
Defining $\theta_n = Q_n |Q_n \alpha - P_n|$, we can write the above
equation as
\begin{equation}\label{CF:Nathan:Eqa}
\frac{\theta_n}{Q_n^2} + \frac{\theta_{n+1}}{Q_{n+1}^2} 
    = \frac{1}{Q_n Q_{n+1}}.
\end{equation}
We want to show that for many values of $n$, 
\[
\theta_n \le \frac{1}{\sqrt{k^2 + 4}}.
\]

Multiplying \eqnref{CF:Nathan:Eqa} by $Q_{n+1}^2$ and solving for
$Q_{n+1}/Q_n$ gives
\begin{equation}\label{CF:Nathan:Eqb}
\frac{Q_{n+1}}{Q_n} = \frac{1 \pm \sqrt{1 - 4 \theta_n
\theta_{n+1}}}{2 \theta_n}.
\end{equation}
Since $Q_{n+1} = a_{n+1} Q_n + Q_{n-1}$, we have
\[
\begin{aligned}\frac{1 + \sqrt{1 - 4 \theta_n \theta_{n+1}}}{2 \theta_n} 
  & \ge a_{n+1} + \frac{Q_{n-1}}{Q_n}, \\
  & \ge a_{n+1} + \frac{2 \theta_{n-1}}{1 + \sqrt{1 - 4 \theta_n
\theta_{n-1}}}, \\
  & \ge a_{n+1} + \frac{1 - \sqrt{1 - 4 \theta_n \theta_{n-1}}}{2 \theta_{n}}
\end{aligned}
\]
So,
\[
2 \theta_n a_{n+1} 
   \le \sqrt{1 - 4 \theta_n \theta_{n-1}} + \sqrt{1 - 4 \theta_n
\theta_{n+1}}.
\]
Defining $\phi_n = \min(\theta_{n-1}, \theta_n, \theta_{n+1})$, we can
rewrite the previous equation as
\[
2 \phi_n a_{n+1} \le 2 \sqrt{1 - 4 \phi_n^2}.
\]
Solving this equation for $\phi_n$ we have
\[
\phi_n \le \frac{1}{\sqrt{a_{n+1}^2 + 4}}.
\]
where equality holds if and only if $\phi_n = \theta_{n-1} = \theta_n
= \theta_{n+1}$.  If this is the case then by \eqnref{CF:Nathan:Eqb}
we have
\[
\frac{Q_n}{Q_{n-1}} = \frac{Q_{n+1}}{Q_{n}} = a_{n+1} +
\frac{Q_{n-1}}{Q_n},
\]
which has no integral solutions for $a_{n+1} \not= 0$.
\end{proof}

\section{Continued Fraction Arithmetic}

This section considers algorithms for performing arithmetic with
continued fractions.  These techniques take a rather different view of
a continued fraction than what has been used till now.  In this view,
a continued fraction is an ``engine'' that, when asked, produces a
unit of information---usually a partial quotient.  The techniques
described here take two continued fraction engines and combine them to
produce a new engine that produces units of information about their
sum or product.  Continuing this process we are able to produce an
engine that produces the successive partial quotients of any
arithmetic expression involving continued fractions.  The units of
information produced by these engines need not only be the partial
quotients.  It is also possible to produce the digits in the decimal
expansion of the number and other results.  This view of continued
fractions was developed by {\Gosper} around 1970 \cite{Hakmem}.

\paragraph{Fractional Linear Forms in One Variable}

To illustrate the basic ideas underlying {\Gosper}'s techniques, we
begin with simple, one variable calculations.  Let $\alpha$ be a
positive real number with the continued fraction
\[
\alpha = [q_0, q_1, q_2, \ldots],
\]
and, as usual, denote by $\alpha_k$
\[
\alpha_k = [q_k, q_{k+1}, \ldots].
\]

Assume we want to determine the continued fraction for $L(\alpha)$, where
\begin{equation}
L(x) = \frac{ax + b}{cx + d}.
\label{BiLinear:Eq}
\end{equation}
While we cannot produce a formula for each of the partial
quotients of $L(\alpha)$:
\[L(\alpha) = [p_0, p_1, p_2, \ldots],
\]
we can develop an algorithm that computes the $p_i$ from the $q_i$.

Using the matrix representation of continued fractions discussed in
\sectref{CF:Matrix:Sec}, we can write $L(\alpha)$ as
\[
L(\alpha) = \begin{pmatrix}a&b\\ c&d\end{pmatrix} \begin{pmatrix}q_0&1\\ 1&0\end{pmatrix}
\begin{pmatrix}q_1&1\\ 1&0\end{pmatrix} \begin{pmatrix}q_2&1\\ 1&0\end{pmatrix} \cdots.
\]

\def\pq#1{\begin{pmatrix}#1& 1 \\ 1 & 0 \end{pmatrix}}
We will transform this infinite product into a new infinite product of the form
\[
\pq{p_0} \pq{p_1} \cdots \pq{p_r} 
\begin{pmatrix}a' & b' \\ c' & d' \end{pmatrix}
\pq{q_s} \pq{q_{s+1}} \cdots.
\]
This is done by alternating between two processes.  One absorbs partial
quotients from the right, while the other produces new partial
quotients on the left.  

For notational convenience, we write $L(\alpha)$ as 
\[
L(\alpha) = \begin{pmatrix}{}_0a_0&_0b_0\\ {}_0c_0&{}_0d_0\end{pmatrix} 
\begin{pmatrix}q_0&1\\ 1&0\end{pmatrix}
\begin{pmatrix}q_1&1\\ 1&0\end{pmatrix} \begin{pmatrix}q_2&1\\ 1&0\end{pmatrix} \cdots,
\]
where the subscripts indicate how many new partial quotients have been
produced (on the left) and how many have been absorbed (on the right).

After absorbing the partial quotients $q_0, \ldots, q_k$, we have
\[
L(\alpha) = \begin{pmatrix}{}_0a_k&{}_0b_k\\ {}_0c_k&{}_0d_k\end{pmatrix} \begin{pmatrix}q_k&1\\ 1&0\end{pmatrix}
\begin{pmatrix}q_{k+1}&1\\ 1&0\end{pmatrix} \begin{pmatrix}q_{k+2}&1\\ 1&0\end{pmatrix} \cdots.
\]

The fractional linear form 
\[
L_k(\alpha) = \frac{{}_0a_k x + {}_0b_k}{{}_0c_k x + {}_0d_k}
\]
has absorbed all the information from the first $k$ partial quotients
of $\alpha$ and combined it with $L(x)$.

Now we need to extract partial quotients from $L_k(x)$.  We know that
$L(\alpha) = L_k(\alpha_k)$.  If the partial quotients of $\alpha_k$
are, as is usually the case, positive integers then $1 \le \alpha_k <
\infty$.  At the two extremes $L_k(\alpha_k)$ takes on the values
\[
\frac{{}_0a_k + {}_0b_k}{{}_0c_k + {}_0d_k} \quad\mbox{and}\quad
\frac{{}_0a_k}{{}_0c_k}.
\]
As we will show in \propref{CF:Linear:Monotonic}, fractional linear
forms are monotonic, so $L_k(\alpha_k)$ lies within the interval 
\[
I = \left[\frac{{}_0a_k + {}_0b_k}{{}_0c_k + {}_0d_k},
\frac{{}_0a_k}{{}_0c_k}\right].
\]
The first partial quotient of $L_k(\alpha_k)$ is the integer
part of $L_k(\alpha_k)$.  If the interval $I$ does not contain any
integers, or equivalently, if the integer part of both endpoints are
the same, then the $p_0$ is well defined. It is, 
\[
p_0 = \left\lfloor \frac{{}_0a_k + {}_0b_k}{{}_0c_k + {}_0d_k}\right\rfloor
    = \left\lfloor \frac{{}_0a_k}{{}_0c_k} \right\rfloor.
\]
To extract the partial quotient from $L_k(\alpha_k)$, we factor $L_k$
as
\[
\begin{aligned}
\begin{pmatrix}{}_0a_k&{}_0b_k\\ {}_0c_k&{}_0d_k\end{pmatrix} & = 
\begin{pmatrix}p_0&1\\ 1&0\end{pmatrix}
\begin{pmatrix}{}_1a_k&{}_1b_k\\ {}_1c_k&{}_1d_k\end{pmatrix}, \\
& = \begin{pmatrix}p_0 {}_1a_k + {}_1c_k & p_0 {}_1b_k + {}_1d_k \\
      {}_1a_k & {}_1b_k \end{pmatrix}.
\end{aligned}
\]

Thus we have the following prescriptions for these two processes.  To
extract the partial quotient $p_{\ell}$ from a linear form we use
\begin{equation}\label{CF:One:Extract:Eq}
\begin {aligned}
  {}_{\ell+1}a_k & = {}_{\ell}c_k \\
  {}_{\ell+1}b_k & = {}_{\ell}d_k \\
  {}_{\ell+1}c_k & = {}_{\ell}a_k - p_{\ell} \,{}_{\ell}c_k\\
  {}_{\ell+1}a_k & = {}_{\ell}b_k - p_{\ell} \,{}_{\ell}d_k
\end{aligned}
\end{equation}

To absorb the partial quotient into a linear form, the following
equations are used:
\begin{equation}\label{CF:One:Absorb:Eq}
\begin {aligned}
  {}_{\ell}a_{k+1} & = q_k {}_{\ell}a_k + {}_{\ell}b_k \\
  {}_{\ell}b_{k+1} & = {}_{\ell}a_k \\
  {}_{\ell}c_{k+1} & = q_k {}_{\ell}c_k +{}_{\ell}d_k\\
  {}_{\ell}a_{k+1} & = {}_{\ell}c_k
\end{aligned}
\end{equation}
The only detail left is the monotonicity result.

\begin{proposition}
\label{CF:Linear:Monotonic}  Invertible fractional linear forms in
one variable are monotonic.
\end{proposition}

\begin{proof}
Let 
\[
L(x) = \frac{a x + b}{c x +d}
\]
be fractional linear function.  If its derivative is never zero then
it must be monotonic.
\[
L'(x) = \frac{a}{c x +d } - \frac{c (a x + b)}{(cx+d)^2}
  = \frac{ad - bc}{(cx+d)^2}.
\]
Thus the sign of the derivative of $L$ is independent of $x$.  It may
be zero, when $ad-bc$ is zero, but then the linear transformation will
not be invertible.
\end{proof}

As an example consider computing the continued fraction expansion of
$\phi = \frac{1 + \sqrt{5}}{2}$ from that of $\sqrt{5} = [2, 4, 4, 4, \ldots]$.
Initially we have
\[
\phi = L(\sqrt{5}) = 
\begin{pmatrix}1 & 1\\ 0 & 2 \end{pmatrix}_1 \begin{pmatrix}2 & 1 \\ 1 & 0 \end{pmatrix}_2
  \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_3 \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_4 \cdots.
\]
To identify the original matrices as the algorithm progresses we have
attached subscripts to the matrices.

Before absorbing any partial quotients, we check to see if we can
output a partial quotient:
\[
\left\lfloor \frac{1+1}{2+0} \right\rfloor = 1 \not= 
  \left\lfloor\frac{1}{2}\right\rfloor.
\]
Multiplying the first two matrices, we get
\[
\phi = \begin{pmatrix}3 & 1\\ 2 & 0 \end{pmatrix} 
  \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_3 \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_4 \cdots.
\]
Again, the range is too large.  Absorbing another partial quotient:
\[
\phi = \begin{pmatrix}13 & 3\\ 8 & 2 \end{pmatrix} \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_4
\cdots,
\]
so the first partial quotient of $\phi$ is $1$.  Using
\eqnref{CF:One:Extract:Eq}, we have
\[
\phi = \begin{pmatrix}1 & 1\\ 1 & 0 \end{pmatrix} \begin{pmatrix}8 & 2 \\ 5 & 1\end{pmatrix}
   \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_4 \cdots.
\]
Since
\[
\left\lfloor \frac{8}{5} \right\rfloor = 1 
  = \left\lfloor\frac{10}{6}\right\rfloor,
\]
the second partial quotient is $1$ also.  In fact we can determine $2$
additional partial quotients:
\[
\begin{aligned}
  \phi &= \begin{pmatrix}1 & 1\\ 1 & 0 \end{pmatrix} \begin{pmatrix}1 & 1\\ 1 & 0 \end{pmatrix}
   \begin{pmatrix}5 & 1\\ 3 & 1\end{pmatrix}
   \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_4 \cdots, \\
   &= \begin{pmatrix}1 & 1\\ 1 & 0 \end{pmatrix} \begin{pmatrix}1 & 1\\ 1 & 0 \end{pmatrix}
      \begin{pmatrix}1 & 1\\ 1 & 0 \end{pmatrix} \begin{pmatrix}3 & 1\\ 2 & 0 \end{pmatrix}
   \begin{pmatrix}4 & 1 \\ 1 & 0 \end{pmatrix}_4 \cdots.
\end{aligned}
\]

Notice that there was not a simple pattern of absorbing and producing
partial quotients---we did not alternate between absorbing and
producing partial quotients.  In fact, the number of partial quotients
absorbed by the fractional linear form did not match the number that
were produced.  This is typical of arithmetic computations with
continued fractions.


\paragraph{Fractional Linear Forms in Two Variables}

In this section we generalize the results of the previous to forms
involving two variables.  Let $\rho = [r_0, r_1, \ldots]$ and $\sigma
= [s_0, s_1, \ldots]$ be two simple continued fractions.  We base the
construction on a rational function of two variables $L(X, Y)$.  We
will compute the continued faction of $L(\rho, \sigma)$. In the first
phase of the algorithm we absorb information from $\rho$ and $\sigma$
into the coefficients of $L$, and in the second phase we extract
partial quotients of the continued fraction for $L(\alpha,\beta)$.

Absorbing new information from $\rho$ is accomplished by replacing
$L(X,Y)$ by $L(r_0 + 1/X',Y)$ and writing this as a fractional form in
$X$ and $Y$.  A similar transformation is used for $Y$.
Extracting a partial quotient $t$ from $L$ is accomplished by writing
\[
\frac{1}{L(X,Y)-q}
\]
as a form in $X$ and $Y$.

The key to the algorithm is the choice of the form $L(X,Y)$.  In order
to make determination of the partial quotients easy, $L(X,Y)$ should
be monotonic. Thus it should be a fractional linear function
separately in $X$ and $Y$.  In order to remain closed under the 
$X \rightarrow r + {X'}^{-1}$ transformation, the form must
be
\[
L(X, Y) = \frac{aXY + b X + c Y + d}{e XY + f X + g Y + h}.
\]

To absorb a partial quotient of $r$ from $X$, we have
\[
\begin{aligned}
 \frac{aXY + b X + c Y + d}{e XY + f X + g Y + h} &\longrightarrow
 \frac{a\left(r + \frac{1}{X'}\right)Y + b \left(r + \frac{1}{X'}\right) + c Y + d}{e \left(r + \frac{1}{X'}\right)Y + f \left(r + \frac{1}{X'}\right) + g Y + h},\\
&= \frac{(r a + c)X'Y + (rb + d) X' + a Y + b}{(r e + g)X'Y + (rf + h) X' + e Y + f}
\end{aligned}
\]
Similarly, to absorb a partial quotient of $s$ from $Y$, we have
\[
 \frac{aXY + b X + c Y + d}{e XY + f X + g Y + h} \longrightarrow
\frac{(s a + b)XY' + a X + (sc + d) Y' + c}{(s e + f)XY' + e X + (sg + h)
Y' + g}.
\]

The formula for extracting  coefficients is quite simple.  To extract
a partial quotient of $t$ from $L(X,Y)$ we compute
\[
\begin{aligned}
 \frac{aXY + b X + c Y + d}{e XY + f X + g Y + h} &\longrightarrow
 \left[ \frac{aXY + b X + c Y + d}{e XY + f X + g Y + h} -
t\right]^{-1}, \\
 & =  \frac{e XY + f X + g Y + h}{(a - t e)XY + (b- tf) X + (c - tg) Y
+ (d - th)}.
\end{aligned}
\]

\section*{Notes}

\Marginpar{Check out Williams's \cite{Williams81} work on the length of the
continued fraction of $\sqrt{D}$.}

\small

There is an extensive literature on continued fractions, especially
from the nineteenth and early twentieth centuries.  The most thorough
reference is {\Perron}'s \cite{Perron:CF}, which is written in German,
but there are also good presentations in English by {\Chrystal}
\cite{Chrystal:Algebra}, {\Hardy} and {\Wright} \cite{Hardy:Wright},
Wall \cite{Wall:CF} and, more recently, {\Olds} \cite{Olds:CF}.  An
elegant and elementary geometric introduction to continued fractions
based on the ideas of {\Klein} \cite{Klein:1895} is given by {\Stark}
\cite{Stark:1970}.  Highly detailed historical information on
continued fractions is given by {\Brezinski} \cite{Brezinski:1991}.

\notesectref{CF:Basics:Sec}
The ``Biblical'' value of $\pi$ comes from first Kings VII 23, where a
circular pool in Solomon's temple is described as being ``ten cubits from
one brim to the other:''
\begin{cjhebrew}
 eiry {\char96}z dim nevw ryx and nytze rc ytze rbl
\end{cjhebrew}
\noindent
and ``and a line thirty cubits did encompass it:''
 \begin{cjhebrew}
ewed yleyim a{\char96}nd iqa {\char96}ze qaia 
\end{cjhebrew}

The discrepancy between this and the real circumference could be viewed
as poetic license.  However, by looking a little closer we can actually
find a better approximation to $\pi$.  The words ``a line'' that appear in
the second quotation are a little unusual.  First, they are not
really needed at all.  Just saying ``and thirty cubits did encompass it''
would have sufficed.  Second, in the original Hebrew these words are
written a little strangely.  What is written is \foreignlanguage{hebrew}{קוה}, [really] where
\textcjheb{we} is the usual spelling for the word ``line.''  Should we interpret
this oddity as a correction factor that should be applied to the
numbers given?  In Hebrew a numerical value is assigned to every
letter, thus each word can be associated with a number, called the
\keyi{gematria} of the word.  Interpretation of these numerical
associates is often used for mystical interpretations of Jewish law.
In this case, the gematria for \textcjheb{hwq} is $100+6+5$ while that for
\textcjheb{we} is $100+6$.  This difference should be interpreted as a
correction factor on the value of $\pi$ given in the previous line.
Thus we see that the real value of $\pi$ 
should be 
\[
\pi = \frac{30}{10} \times \frac{111}{106} = \frac{333}{106}
\]
which is much closer to modern values.  In fact, this is the third
continued fraction approximate to $\pi$ while $3$ is the first.  This
interpretation is usually ascribed to Elijah the Gaon of
Vilna\index{Elijah, Gaon of Vilna} (1720--1797).  Perhaps by looking
at the text more closely one can find $355/113$?

Chiu-Shao Ch'in\index{Chiu-Shao Ch'in} used $22/7$ as an approximation
as early as 1250.  In 1583 Valentinus Otha\index{Otha, Valentinus}
suggested $355/113$ as an approximation.  Others who suggested
$355/113$ at this time include Fran\c{c}ois Viete\index{Viete,
Fran\c{c}ois}, Adriaan Anthoniszoon\index{Anthoniszoon, Adriaan} and
his son Adriaen Metius.\index{Metius, Adriaen} $355/113$ is often
referred to as Metius's approximation.\index{Metius's approximation}

\notesectref{CF:Quadratics:Sec}  Computing the continued fraction of a
general real algebraic number is more difficult than for square roots
of integers.  The main problem is keeping the different conjugates of
the number separate.  A discussion of the issues involved and
algorithms for computing these continued fractions is given in
\cite{Cantor72,Thull84}.

\notesectref{CF:Approximation:Sec} {\Nathanson}'s proof is a
generalization of an earlier proof of {\Hurwitz}'s theorem by {\CohnJHE}
\cite{Cohn73}.

\index{continued fraction|)}
\normalsize


